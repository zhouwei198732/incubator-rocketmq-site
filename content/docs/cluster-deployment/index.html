<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Cluster Configuration and Deployment - Apache RocketMQ</title>




<meta name="description" content="Prerequisite">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Apache RocketMQ">
<meta property="og:title" content="Cluster Configuration and Deployment">




  <meta property="og:description" content="Prerequisite">



  <meta name="twitter:site" content="@ApacheRocketMQ">
  <meta name="twitter:title" content="Cluster Configuration and Deployment">
  <meta name="twitter:description" content="Prerequisite">
  <meta name="twitter:url" content="">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-12-29T16:04:39+08:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Apache RocketMQ",
      "url" : null,
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Apache RocketMQ Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="/">Apache RocketMQ</a></li>
          
            
            <li class="masthead__menu-item"><a href="/docs/quick-start/">Documentation</a></li>
          
            
            <li class="masthead__menu-item"><a href="/year-archive/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="/community/">Community</a></li>
          
            
            <li class="masthead__menu-item"><a href="/about/">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">User Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/quick-start/" class="">Quick Start</a></li>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Motivation</a></li>
          
            
            

            
            

            <li><a href="/docs/core-concept/" class="">Core Concept</a></li>
          
            
            

            
            

            <li><a href="/docs/cli-admin-tool/" class="">CLI Admin Tool</a></li>
          
            
            

            
            

            <li><a href="/docs/cluster-deployment/" class="active">Cluster Configuration & Deployment</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contributor Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/pull-request/" class="">Best Practice in PR</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Developer Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Architecture & Design</a></li>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Communication Protocol</a></li>
          
            
            

            
            

            <li><a href="/docs/core-concept/" class="">Persistence</a></li>
          
            
            

            
            

            <li><a href="/docs/cli-admin-tool/" class="">Replication</a></li>
          
            
            

            
            

            <li><a href="/docs/cluster-deployment/" class="active">Service Discovery & Load Balance</a></li>
          
            
            

            
            

            <li><a href="/docs/cluster-deployment/" class="active">Message Filter</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Best Practice</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Broker</a></li>
          
            
            

            
            

            <li><a href="/docs/motivation/" class="">Producer</a></li>
          
            
            

            
            

            <li><a href="/docs/core-concept/" class="">Consumer</a></li>
          
            
            

            
            

            <li><a href="/docs/cli-admin-tool/" class="">Virtualization</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/docs/faq/"><span class="nav__sub-title">FAQ</span></a>
        

        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Cluster Configuration and Deployment">
    <meta itemprop="description" content="Prerequisite">
    <meta itemprop="datePublished" content="December 29, 2016">
    <meta itemprop="dateModified" content="December 17, 2016">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Cluster Configuration and Deployment
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <h1 id="prerequisite">Prerequisite</h1>

<p>Before starting this section, make sure you have read Quick Start section, in which core concepts and components of RocketMQ are introduced.</p>

<aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-file-text"></i> On This Page</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#prerequisite" id="markdown-toc-prerequisite">Prerequisite</a></li>
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#name-server" id="markdown-toc-name-server">Name Server</a></li>
  <li><a href="#broker" id="markdown-toc-broker">Broker</a></li>
  <li><a href="#disk-flush-type-sync_flush--async_flush" id="markdown-toc-disk-flush-type-sync_flush--async_flush">Disk Flush Type: SYNC_FLUSH / ASYNC_FLUSH</a></li>
  <li><a href="#replication-sync--async-broker" id="markdown-toc-replication-sync--async-broker">Replication: Sync / Async Broker</a></li>
  <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
  <li><a href="#deployment-example" id="markdown-toc-deployment-example">Deployment Example</a></li>
</ul>

  </nav>
</aside>

<h1 id="introduction">Introduction</h1>

<p>This section is to introduce deployment solution that may be considered production ready.  Generally speaking, we are deploying a resilient RocketMQ cluster having no single point of failure.</p>

<h1 id="name-server">Name Server</h1>

<p>To ensure the cluster can still operate normally when name server instance crashes, two or more name server instances are recommended.  As long as there is one name server instance alive, the whole cluster remains serving.</p>

<p>Name server follows share-nothing design paradigm. Brokers send heartbeat data to all name servers. Producers and consumers may query meta data from any one of name servers available while sending / consuming messages.</p>

<h1 id="broker">Broker</h1>

<p>Brokers can be divided into two categories according to their roles: master and slave. Master brokers can read and write while slave brokers can only read messages replicated from master. Master brokers have brokerId=0; brokerId of slave is non-zero.</p>

<p>Brokers may also be grouped by the brokerName property. Slave brokers find their master through brokerName. One master broker along with zero, one or multiple slave brokers is called a broker set.</p>

<p>In serious scenarios, we should have at least two broker sets. Each topic, as you guess,  resides in two or more broker sets.</p>

<h1 id="disk-flush-type-sync_flush--async_flush">Disk Flush Type: SYNC_FLUSH / ASYNC_FLUSH</h1>

<p>Each broker can be configured to be sync or async in terms of IO flushing strategy. To put it simply, if your business tolerates none message loss at extreme scenarios like OS crash or power loss, SYNC_FLUSH mode is recommended. Broker of SYNC_FLUSH mode would flush each message it receives onto disk before acknowledging producer. Obviously, throughout of this mode is highly dependent on IOPS of your hard disk.</p>

<p>Broker of ASYNC_FLUSH mode, on the other hand, takes advantage of group-committing: only flushes dirty page caches to disk periodically or when count of dirty page caches reaches certain amount. Hence, the latter yields better performance.</p>

<h1 id="replication-sync--async-broker">Replication: Sync / Async Broker</h1>

<p>Similar to many replication system, sync brokers await until commit log is replicated to a slave before acknowledging. Async brokers, instead, return immediately after messages are processed on master.</p>

<h1 id="configuration">Configuration</h1>

<p>There are three pre-built configurations shipped with the distribution of RocketMQ under conf folder for your reference:</p>

<ol>
  <li>2m-2s-sync</li>
  <li>2m-2s-async</li>
  <li>2m-noslave</li>
</ol>

<p>Note: all configurations uses ASYNC_FLUSH.</p>

<h1 id="deployment-example">Deployment Example</h1>

<p>For example, We want to have a cluster with 2 name servers, 2 broker sets with general purpose:
for this example, we choose <code class="highlighter-rouge">2m-2s-sync</code>
Assuming binary RocketMQ is at <code class="highlighter-rouge">/home/rocketmq/dist</code></p>

<ol>
  <li>
    <p>Start up two name servers as is shown in Quick Start guide. Assume their IPs are 192.168.0.2 and 192.168.0.3.</p>
  </li>
  <li>
    <p>Start brokers</p>

    <p><code class="highlighter-rouge">cd /home/rocketmq/dist/bin</code></p>

    <p><code class="highlighter-rouge">bash mqbroker -c ../conf/2m-2s-sync/broker-a.properties -n 192.168.0.2:9876,192.168.0.3:9876</code></p>

    <p><code class="highlighter-rouge">bash mqbroker -c ../conf/2m-2s-sync/broker-a-s.properties -n 192.168.0.2:9876,192.168.0.3:9876</code></p>

    <p><code class="highlighter-rouge">bash mqbroker -c ../conf/2m-2s-sync/broker-b.properties -n 192.168.0.2:9876,192.168.0.3:9876</code></p>

    <p><code class="highlighter-rouge">bash mqbroker -c ../conf/2m-2s-sync/broker-b-s.properties -n 192.168.0.2:9876,192.168.0.3:9876</code></p>
  </li>
  <li>
    <p>Verify</p>

    <p>Execute the following command to verify</p>

    <p><code class="highlighter-rouge">bash mqadmin clusterList</code></p>
  </li>
</ol>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-12-17">December 17, 2016</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ApacheRocketMQ&text=Cluster Configuration and Deployment /docs/cluster-deployment/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=/docs/cluster-deployment/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=/docs/cluster-deployment/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=/docs/cluster-deployment/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/docs/cli-admin-tool/" class="pagination--pager" title="CLI Admin Tool
">Previous</a>
    
    
      <a href="/docs/pull-request/" class="pagination--pager" title="Best Practice in Pull Request
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/ApacheRocketMQ"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/apache/incubator-rocketmq"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">Copyright &copy; 2016 <a href="http://www.apache.org/">The Apache Software Foundation</a>. All Rights Reserved.</div>
      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>





  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'rocketmq';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
